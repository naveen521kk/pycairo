name: Build

on: [push]

jobs:
  build_wheels:
    name: Build wheels for Windows on ${{ matrix.python-version }}
    runs-on: windows-latest
    env:
      CAIRO_VERSION: "1.17.2"
    strategy:
      matrix:
        python-version: [3.5, 3.6, 3.7, 3.8]

    steps:
      - uses: actions/checkout@v2
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}
      - name: Test path
        run: |
          curl -L https://github.com/preshing/cairo-windows/releases/download/$CAIRO_VERSION/cairo-windows-$CAIRO_VERSION.zip -o cairocomplied.zip
          7z x cairocomplied.zip
          Move-Item "cairo-windows-*\" "cairocomplied\"
          $env:INCLUDE="$PWD\cairocomplied\include\"
          $env:LIB="$PWD\cairocomplied\lib\x64\"
          Copy-Item cairocomplied/lib/x64/cairo.dll cairo/cairo.dll
          #$env:LIB="D:\a\_temp\msys\msys64\mingw64\lib\"
          python -m pip install --upgrade pip
          python -m pip install --upgrade wheel
          python -m pip install --upgrade setuptools
          python -m pip install --upgrade pytest
          python setup.py install
          python setup.py bdist_wheel
          pytest
      - uses: actions/upload-artifact@v2
        with:
         name: wheels
         path: dist/*
